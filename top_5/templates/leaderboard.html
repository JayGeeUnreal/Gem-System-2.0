<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Leaderboards</title>
    <style>
        * { box-sizing: border-box; }

        html, body {
            margin: 0; padding: 0;
            width: 1480px; 
            height: 720px;
            overflow: hidden;
            background-color: transparent; 
            font-family: 'Segoe UI', sans-serif;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        /* --- SHARED STYLES --- */
        .square {
            width: 720px;
            height: 720px;
            border: 5px solid #444;
            border-radius: 30px;
            background: #252526;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        h1 {
            text-align: center; font-size: 50px; margin: 10px 0 5px 0;
            text-transform: uppercase; letter-spacing: 3px; line-height: 1;
            padding-bottom: 5px;
        }

        /* SUBTITLE (Source Name) */
        h2 {
            text-align: center;
            font-size: 24px;
            color: #888;
            margin: 0 0 20px 0;
            font-weight: normal;
            border-bottom: 3px solid #444;
            padding-bottom: 20px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .title-mentions { color: #eebb00; }
        .title-talkers { color: #ff5555; }

        .list {
            flex-grow: 1; display: flex; flex-direction: column; gap: 10px;
        }

        .entry {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 45px; padding: 15px 30px;
            border-bottom: 2px solid #333; background: #2d2d30; border-radius: 12px;
        }
        .entry:last-child { border-bottom: none; }
        
        /* Rank Colors */
        .entry:nth-child(1) .rank { color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
        .entry:nth-child(2) .rank { color: #C0C0C0; }
        .entry:nth-child(3) .rank { color: #CD7F32; }

        .rank { font-weight: bold; width: 60px; }
        .name { flex-grow: 1; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 15px;}
        .score { font-weight: bold; color: #61dafb; min-width: 90px; text-align: right; }
        
        .waiting { text-align:center; padding-top:150px; color:#555; font-size:30px; }
    </style>
</head>
<body>

    <!-- SQUARE 1: Top Mentions -->
    <div class="square">
        <h1 class="title-mentions">Top Mentions</h1>
        <h2 id="source-name-1">Stream Chat : Waiting...</h2>
        <div class="list" id="list-mentions"></div>
    </div>

    <!-- SQUARE 2: Top Shit Talkers -->
    <div class="square">
        <h1 class="title-talkers">Top Shit Talkers</h1>
        <h2 id="source-name-2">Stream Chat : Waiting...</h2>
        <div class="list" id="list-talkers"></div>
    </div>

    <script>
        setInterval(fetchData, 2000);

        async function fetchData() {
            try {
                const res = await fetch('/api/live');
                const data = await res.json();

                // 1. Render Lists
                renderList('list-mentions', data.leaderboard_mentions);
                renderList('list-talkers', data.leaderboard_talkers);
                
                // 2. Update Source Name (ON BOTH SQUARES)
                if (data.messages && data.messages.length > 0) {
                    const latestMsg = data.messages[0];
                    const srcName = latestMsg.sourceName || latestMsg.type || "Unknown";
                    const displayText = "Stream Chat : " + srcName;
                    
                    // Update Box 1
                    const el1 = document.getElementById('source-name-1');
                    if(el1.innerText !== displayText) {
                        el1.innerText = displayText;
                        el1.style.color = "#ccc";
                    }

                    // Update Box 2
                    const el2 = document.getElementById('source-name-2');
                    if(el2.innerText !== displayText) {
                        el2.innerText = displayText;
                        el2.style.color = "#ccc";
                    }
                }

            } catch (err) { console.error(err); }
        }

        function renderList(elementId, items) {
            const container = document.getElementById(elementId);
            if (!items || items.length === 0) {
                container.innerHTML = '<div class="waiting">Waiting for data...</div>';
                return;
            }
            let html = '';
            items.forEach((entry, index) => {
                const name = entry[0];
                const score = entry[1];
                html += `
                    <div class="entry">
                        <div class="rank">#${index + 1}</div>
                        <div class="name">${name}</div>
                        <div class="score">x ${score}</div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        fetchData();
    </script>
</body>
</html>